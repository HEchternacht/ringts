<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RINGTS - Player Analytics Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Live Delta Feed -->
        <div class="live-feed-sidebar" id="liveFeed">
            <div class="live-feed-header">
                <h3>ğŸ”´ Live EXP Feed</h3>
                <span class="live-indicator">LIVE</span>
            </div>
            <div class="live-feed-content" id="liveFeedContent">
                <div class="live-feed-placeholder">
                    <p>Connecting to live feed...</p>
                </div>
            </div>
        </div>

        <div class="main-content">
        <header>
            <h1>ğŸ® RINGTS Analytics Dashboard</h1>
            <p>Track player experience gains and performance over time</p>
            <div class="header-controls">
                <div class="scraper-status" id="scraperStatus">
                    <span class="status-indicator"></span>
                    <span class="status-text">Connecting...</span>
                </div>
                <div class="status-times" id="statusTimes">
                    <div class="status-time-item">
                        <span class="time-label">Last Update:</span>
                        <span class="time-value" id="lastUpdateTime">--</span>
                    </div>
                    <div class="status-time-item">
                        <span class="time-label">Last Check:</span>
                        <span class="time-value" id="lastCheckTime">--</span>
                    </div>
                </div>
                <button id="manualUpdate" class="btn-update" title="Manually update rankings">
                    ğŸ”„ Update Now
                </button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="dashboard">ğŸ“Š Dashboard</button>
            <button class="tab-btn" data-tab="rankings">ğŸ† Rankings Table</button>
            <button class="tab-btn" data-tab="console">ğŸ–¥ï¸ Console</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">

        <div class="controls-section">
            <div class="control-group">
                <h2>ğŸ¯ Select Players</h2>
                <div class="player-selector">
                    <input type="text" id="playerSearch" placeholder="Search players..." />
                    <div id="playerList" class="player-list"></div>
                    <div id="selectedPlayers" class="selected-players"></div>
                </div>
            </div>

            <div class="control-group">
                <h2>ğŸ“… Date Range (Optional)</h2>
                <div class="date-inputs">
                    <div class="date-field">
                        <label for="startDate">Start Date & Time:</label>
                        <input type="datetime-local" id="startDate" />
                    </div>
                    <div class="date-field">
                        <label for="endDate">End Date & Time:</label>
                        <input type="datetime-local" id="endDate" />
                    </div>
                    <button id="clearDates" class="btn-secondary">Clear Dates</button>
                </div>
            </div>

            <div class="action-buttons">
                <button id="generateVisualization" class="btn-primary">ğŸ“Š Generate Visualization</button>
                <button id="clearAll" class="btn-secondary">ğŸ—‘ï¸ Clear All</button>
            </div>
        </div>

        <div class="results-section">
            <div class="graph-container">
                <h2>ğŸ“Š EXP Gain Over Time</h2>
                <div id="graphDiv" class="graph-placeholder">
                    <p>Select players and click "Generate Visualization" to view data</p>
                </div>
            </div>

            <div class="info-container">
                <div class="comparison-section">
                    <h2>ğŸ† Player Comparison</h2>
                    <div id="comparisonInfo" class="comparison-placeholder">
                        <p>Click "Generate Visualization" to see rankings and comparisons</p>
                    </div>
                </div>
                
                <div class="stats-section">
                    <h2>ğŸ“ˆ Detailed Statistics</h2>
                    <div id="statsTable" class="stats-placeholder">
                        <p>Statistical breakdown will appear here</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <p>Loading data...</p>
        </div>

        <div class="error-message" id="errorMessage"></div>
        </div>
        <!-- End Dashboard Tab -->

        <!-- Rankings Table Tab -->
        <div class="tab-content" id="rankings-tab">
            <div class="controls-section">
                <div class="control-group">
                    <h2>ğŸ“… Select Date Range</h2>
                    <div class="date-inputs">
                        <div class="date-field">
                            <label for="rankStartDate">Start Date & Time:</label>
                            <input type="datetime-local" id="rankStartDate" />
                        </div>
                        <div class="date-field">
                            <label for="rankEndDate">End Date & Time:</label>
                            <input type="datetime-local" id="rankEndDate" />
                        </div>
                        <button id="loadRankings" class="btn-primary">ğŸ”„ Load Rankings</button>
                    </div>
                </div>
            </div>

            <div class="rankings-table-container">
                <h2>ğŸ† Player Rankings</h2>
                <p class="table-hint">ğŸ’¡ Leave dates empty for all-time rankings. Click any player name to view their graph.</p>
                <div class="table-controls">
                    <input type="text" id="rankingsSearch" placeholder="Search players..." class="search-input" />
                    <select id="sortColumn" class="sort-select">
                        <option value="total_exp">Sort by: Total EXP</option>
                        <option value="updates">Sort by: Updates</option>
                        <option value="avg_exp">Sort by: Average EXP</option>
                        <option value="max_exp">Sort by: Max EXP</option>
                        <option value="min_exp">Sort by: Min EXP</option>
                        <option value="name">Sort by: Name</option>
                    </select>
                    <button id="sortOrder" class="btn-secondary sort-btn" data-order="desc">â¬‡ï¸ Descending</button>
                </div>
                <div id="rankingsTableContent" class="rankings-placeholder">
                    <p>Select a date range and click "Load Rankings" to view data</p>
                </div>
            </div>
        </div>
        <!-- End Rankings Table Tab -->

        <!-- Console Tab -->
        <div class="tab-content" id="console-tab">
            <div class="console-container">
                <div class="console-header">
                    <h2>ğŸ–¥ï¸ System Console</h2>
                    <div class="console-controls">
                        <button id="clearConsole" class="btn-secondary">Clear</button>
                        <button id="pauseConsole" class="btn-secondary">â¸ï¸ Pause</button>
                        <label>
                            <input type="checkbox" id="autoScroll" checked />
                            Auto-scroll
                        </label>
                    </div>
                </div>
                <div id="consoleOutput" class="console-output"></div>
            </div>
        </div>
        </div>
        <!-- End Console Tab -->

        <!-- Player Graph Modal -->
        <div class="modal" id="playerModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalPlayerName">Player EXP Graph</h2>
                    <button class="modal-close" onclick="closePlayerModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="modalGraphDiv" style="width: 100%; height: 500px;"></div>
                </div>
            </div>
        </div>

        </div>
        <!-- End main-content -->

    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
