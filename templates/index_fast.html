<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAD - XISNOVE Analytics Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Live Delta Feed -->
        <div class="live-feed-sidebar" id="liveFeed">
            <div class="live-feed-header">
                <h3>ğŸ”´ Live EXP Feed</h3>
                <span class="live-indicator">LIVE</span>
            </div>
            <div class="live-feed-content" id="liveFeedContent">
                <div class="live-feed-placeholder">
                    <p>Connecting to live feed...</p>
                </div>
            </div>
        </div>

        <div class="main-content">
        <nav class="main-nav">
            <a href="/" class="nav-link active">Dashboard</a>
            <a href="/vip" class="nav-link">VIP Tracking</a>
        </nav>
        
        <header>
            <h1>ğŸ® XISNOVE Analytics Dashboard</h1>
            <p>Te peguei caÃ§ando no massivo</p>
            
            <!-- Global Filters -->
            <div class="global-filters">
                <div class="filter-group">
                    <label for="worldFilter">ğŸŒ World:</label>
                    <select id="worldFilter" class="filter-select">
                        <option value="Auroria">Auroria</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="guildFilter">âš”ï¸ Guild:</label>
                    <select id="guildFilter" class="filter-select">
                        <option value="Ascended Auroria">Ascended Auroria</option>
                    </select>
                </div>
                <button id="applyFilters" class="btn-filter">Apply Filters</button>
            </div>
            
            <div class="header-controls">
                <div class="scraper-status" id="scraperStatus">
                    <span class="status-indicator"></span>
                    <span class="status-text">Connecting...</span>
                </div>
                <div class="system-health" id="systemHealth">
                    <div class="health-item" id="healthStatus" title="Click for details">
                        <span class="health-icon">â¤ï¸</span>
                        <span class="health-text">Health: --</span>
                    </div>
                    <div class="health-item" id="memoryStatus" title="Memory usage">
                        <span class="health-icon">ğŸ’¾</span>
                        <span class="health-text">RAM: --</span>
                    </div>
                </div>
                <div class="status-times" id="statusTimes">
                    <div class="status-time-item world-status-dropdown">
                        <span class="time-label">Last Update:</span>
                        <span class="time-value" id="lastUpdateTime">--</span>
                        <div class="world-status-popup" id="worldStatusPopup">
                            <div class="world-status-header">
                                <h4>ğŸŒ World Status</h4>
                                <span class="fetch-time" id="fetchTime">--</span>
                            </div>
                            <div class="world-status-content" id="worldStatusContent">
                                <p>Loading...</p>
                            </div>
                        </div>
                    </div>
                    <div class="status-time-item">
                        <span class="time-label">Last Check:</span>
                        <span class="time-value" id="lastCheckTime">--</span>
                    </div>
                </div>
                <button id="manualUpdate" class="btn-update" title="Manually update rankings">
                    ğŸ”„ Update Now
                </button>
            </div>
            
            <!-- Health Details Modal -->
            <div class="health-modal" id="healthModal" style="display: none;">
                <div class="health-modal-content">
                    <div class="health-modal-header">
                        <h3>ğŸ¥ System Health Details</h3>
                        <button class="modal-close" onclick="closeHealthModal()">&times;</button>
                    </div>
                    <div class="health-modal-body" id="healthModalBody">
                        <p>Loading...</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="dashboard">ğŸ“Š Dashboard</button>
            <button class="tab-btn" data-tab="rankings">ğŸ† Rankings Table</button>
            <button class="tab-btn" data-tab="data">ğŸ’¾ Data Management</button>
            <button class="tab-btn" data-tab="console">ğŸ–¥ï¸ Console</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">

        <div class="controls-section">
            <div class="control-group">
                <h2>ğŸ¯ Select Players</h2>
                <div class="player-selector">
                    <input type="text" id="playerSearch" placeholder="Search players..." />
                    <div id="playerList" class="player-list"></div>
                    <div id="selectedPlayers" class="selected-players"></div>
                </div>
            </div>

            <div class="control-group">
                <h2>ğŸ“… Date Range (Optional)</h2>
                <div class="date-inputs">
                    <div class="date-field">
                        <label for="startDate">Start Date & Time:</label>
                        <input type="datetime-local" id="startDate" />
                    </div>
                    <div class="date-field">
                        <label for="endDate">End Date & Time:</label>
                        <input type="datetime-local" id="endDate" />
                    </div>
                    <button id="clearDates" class="btn-secondary">Clear Dates</button>
                </div>
            </div>

            <div class="action-buttons">
                <button id="generateVisualization" class="btn-primary">ğŸ“Š Generate Visualization</button>
                <button id="clearAll" class="btn-secondary">ğŸ—‘ï¸ Clear All</button>
            </div>
        </div>

        <div class="results-section">
            <div class="graph-container">
                <h2>ğŸ“Š EXP Gain Over Time</h2>
                <div id="graphDiv"></div>
            </div>

            <div class="info-container">
                <div class="comparison-section">
                    <div class="carousel-header">
                        <button class="carousel-nav-btn" id="comparisonPrevBtn" style="visibility: hidden;">&lt;</button>
                        <h2 id="comparisonTitle">ğŸ† Player Comparison</h2>
                        <button class="carousel-nav-btn" id="comparisonNextBtn" style="visibility: hidden;">&gt;</button>
                    </div>
                    <div class="carousel-wrapper">
                        <div id="comparisonCarousel" class="carousel-container">
                            <div class="carousel-item active" id="comparisonInfo">
                                <p>Click "Generate Visualization" to see rankings and comparisons</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-section">
                    <h2>ğŸ“ˆ Detailed Statistics</h2>
                    <div id="statsTable" class="stats-placeholder">
                        <p>Statistical breakdown will appear here</p>
                    </div>
                </div>

                <div class="player-details-dashboard" id="playerDetailsDashboard" style="display: none;">
                    <div class="carousel-header">
                        <button class="carousel-nav-btn" id="playerDetailsPrevBtn" style="visibility: hidden;">&lt;</button>
                        <h2 id="dashboardPlayerName">ğŸ“‹ Player Details</h2>
                        <button class="carousel-nav-btn" id="playerDetailsNextBtn" style="visibility: hidden;">&gt;</button>
                    </div>
                    
                    <!-- Dashboard Tabs -->
                    <div class="dashboard-main-tabs">
                        <button class="dashboard-main-tab-btn active" onclick="switchDashboardMainTab('multi-graph')">ğŸ“ˆ Multi-Graph</button>
                        <button class="dashboard-main-tab-btn" onclick="switchDashboardMainTab('tables')">ğŸ“Š Tables</button>
                    </div>
                    
                    <!-- Multi-Graph Tab -->
                    <div class="dashboard-tab-content active" id="dashboard-multi-graph">
                        <div id="dashboardMultiGraphDiv" class="combined-overview-chart" style="margin-top: 20px;"></div>
                    </div>
                    
                    <!-- Tables Tab -->
                    <div class="dashboard-tab-content" id="dashboard-tables">
                        <div class="loading-overlay" id="dashboardDetailsLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading player details...</p>
                        </div>
                        <div id="dashboardDetailsContent" class="dashboard-details-content">
                            <!-- Player details will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <p>Loading data...</p>
        </div>

        <div class="error-message" id="errorMessage"></div>
        </div>
        <!-- End Dashboard Tab -->

        <!-- Rankings Table Tab -->
        <div class="tab-content" id="rankings-tab">
            <div class="controls-section">
                <div class="control-group">
                    <h2>ğŸ“… Select Date Range</h2>
                    <div class="date-inputs">
                        <div class="date-field">
                            <label for="rankStartDate">Start Date & Time:</label>
                            <input type="datetime-local" id="rankStartDate" />
                        </div>
                        <div class="date-field">
                            <label for="rankEndDate">End Date & Time:</label>
                            <input type="datetime-local" id="rankEndDate" />
                        </div>
                        <button id="loadRankings" class="btn-primary">ğŸ”„ Load Rankings</button>
                    </div>
                </div>
            </div>

            <div class="rankings-table-container">
                <h2>ğŸ† Player Rankings</h2>
                <p class="table-hint">ğŸ’¡ Leave dates empty for all-time rankings. Click any player name to view their graph.</p>
                <div class="table-controls">
                    <input type="text" id="rankingsSearch" placeholder="Search players..." class="search-input" />
                    <select id="sortColumn" class="sort-select">
                        <option value="total_exp">Sort by: Total EXP</option>
                        <option value="updates">Sort by: Updates</option>
                        <option value="avg_exp">Sort by: Average EXP</option>
                        <option value="max_exp">Sort by: Max EXP</option>
                        <option value="min_exp">Sort by: Min EXP</option>
                        <option value="name">Sort by: Name</option>
                    </select>
                    <button id="sortOrder" class="btn-secondary sort-btn" data-order="desc">â¬‡ï¸ Descending</button>
                </div>
                <div id="rankingsTableContent" class="rankings-placeholder">
                    <p>Select a date range and click "Load Rankings" to view data</p>
                </div>
            </div>
        </div>
        <!-- End Rankings Table Tab -->

        <!-- Data Management Tab -->
        <div class="tab-content" id="data-tab">
            <div class="data-management-container">
                <h2>ğŸ’¾ Data Management</h2>
                <p class="info-text">Upload and download your CSV database files for backup or migration purposes.</p>
                
                <div class="data-section">
                    <h3>ğŸ“Š Deltas Data (deltas.csv)</h3>
                    <p class="description">Contains all player EXP change records over time</p>
                    <div class="data-actions">
                        <a href="/api/download/deltas" class="btn-primary" download>â¬‡ï¸ Download deltas.csv</a>
                        <div class="upload-container">
                            <input type="password" id="deltasPassword" placeholder="Upload password" class="password-input" />
                            <input type="file" id="uploadDeltas" accept=".csv" style="display: none;" />
                            <button class="btn-secondary" onclick="document.getElementById('uploadDeltas').click()">â¬†ï¸ Upload deltas.csv</button>
                            <span id="deltasFileName" class="file-name"></span>
                        </div>
                    </div>
                    <div id="deltasStatus" class="status-message"></div>
                </div>

                <div class="data-section">
                    <h3>ğŸ‘¥ Player Experience Data (exps.csv)</h3>
                    <p class="description">Contains current player EXP totals and last update times</p>
                    <div class="data-actions">
                        <a href="/api/download/exps" class="btn-primary" download>â¬‡ï¸ Download exps.csv</a>
                        <div class="upload-container">
                            <input type="password" id="expsPassword" placeholder="Upload password" class="password-input" />
                            <input type="file" id="uploadExps" accept=".csv" style="display: none;" />
                            <button class="btn-secondary" onclick="document.getElementById('uploadExps').click()">â¬†ï¸ Upload exps.csv</button>
                            <span id="expsFileName" class="file-name"></span>
                        </div>
                    </div>
                    <div id="expsStatus" class="status-message"></div>
                </div>

                <div class="warning-box">
                    <h4>âš ï¸ Important Notes:</h4>
                    <ul>
                        <li>Password is required to upload files</li>
                        <li>Always backup your current data before uploading new files</li>
                        <li>Uploaded files must be valid CSV format with correct column names</li>
                        <li>A backup of the existing file will be created automatically</li>
                        <li>The scraper will continue using the new data immediately after upload</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- End Data Management Tab -->

        <!-- Console Tab -->
        <div class="tab-content" id="console-tab">
            <div class="console-container">
                <div class="console-header">
                    <h2>ğŸ–¥ï¸ System Console</h2>
                    <div class="console-controls">
                        <button id="clearConsole" class="btn-secondary">Clear</button>
                        <button id="pauseConsole" class="btn-secondary">â¸ï¸ Pause</button>
                        <label>
                            <input type="checkbox" id="autoScroll" checked />
                            Auto-scroll
                        </label>
                    </div>
                </div>
                <div id="consoleOutput" class="console-output"></div>
            </div>
        </div>
        </div>
        <!-- End Console Tab -->

        <!-- Player Graph Modal -->
        <div class="modal" id="playerModal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="modalPlayerName">Player EXP Graph</h2>
                    <button class="modal-close" onclick="closePlayerModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Main Tabs -->
                    <div class="modal-main-tabs">
                        <button class="modal-main-tab-btn active" onclick="switchModalMainTab('raw-graph')">ğŸ“Š Raw Graph</button>
                        <button class="modal-main-tab-btn" onclick="switchModalMainTab('multi-graph')">ğŸ“ˆ Multi-Graph</button>
                        <button class="modal-main-tab-btn" onclick="switchModalMainTab('tables')">ğŸ“‹ Tables</button>
                    </div>
                    
                    <!-- Tab Contents -->
                    <div class="modal-tab-content active" id="modal-raw-graph">
                        <div id="modalGraphDiv" style="width: 100%; height: 500px;"></div>
                    </div>
                    
                    <div class="modal-tab-content" id="modal-multi-graph">
                        <div class="loading-overlay" id="multiGraphLoading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Loading multi-graph...</p>
                        </div>
                        <div id="modalMultiGraphDiv" class="combined-overview-chart"></div>
                    </div>
                    
                    <div class="modal-tab-content" id="modal-tables">
                        <div class="loading-overlay" id="playerDetailsLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading player details...</p>
                        </div>
                        <div id="playerDetailsContent" class="player-details-content" style="display: none;">
                            <!-- Player details will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        </div>
        <!-- End main-content -->
        

    </div>

    <footer class="site-footer">
        <span class="accent" aria-hidden="true"></span>
        <span class="credit">...made by <strong>Rollabostx</strong></span>
    </footer>
    <script src="/static/app.js"></script>
</body>
</html>
